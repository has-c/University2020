---
title: "326 Assignment 2"
author: "Hasnain Cheena"
date: "30/03/2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(s20x)
```

```{r Data Input}
df = read.table('Cape Grim.CO2.quarterly.txt', header=TRUE) 
time <- seq(2000.25,2019.75,0.25)
df["Time"] = time
#2000 Q1 to 2018.3 - training data
#2018.4 to 2019.4
trainDf = df[1:75,]
testDf = df[76:79,]

CO2.train.ts = ts(trainDf$CO2, frequency = 4, start=c(2000,1))
CO2.test.ts = ts(testDf$CO2, frequency = 4, start=c(2018,4))

Time = 1:79
trainTime = 1:75
testTime = 76:79
```


## Question 1
```{r Q1}
HW.fit = HoltWinters(CO2.train.ts)
HW.fit

HW.pred = predict(HW.fit,n.ahead=4)
HW.pred

HW.RMSEP = sqrt(1/4*sum((CO2.test.ts-HW.pred)^2))

plot(HW.fit, HW.pred, main="Cape Grim CO2 - Holt Winters", xlab="Time", ylab="Observed/Fitted CO2 (ppm)")
```
## Question 2
```{r Q2}

#Moving Average Model
decomp.ma.CO2 = decompose(CO2.train.ts)
ma.CO2.ts = CO2.train.ts - decomp.ma.CO2$seasonal
plot(ma.CO2.ts, main="Moving average seasonally adjusted CO2 Cape Grim", xlab="Time", ylab="CO2 (ppm)")

#build seasonality adjusted model 
#method from page 61
#change in trend at t=50
Time.train.break = c(rep(0,49), trainTime[50:75]-trainTime[50])
co2.break.fit = lm(ma.CO2.ts ~ trainTime+Time.train.break)
plot.ts(residuals(co2.break.fit))
acf(residuals(co2.break.fit))
#add lagged response variable 
co2.break.fit2 = lm(ma.CO2.ts[-1] ~ trainTime[-1]+Time.train.break[-1] + ma.CO2.ts[-75])
plot.ts(residuals(co2.break.fit2))
acf(residuals(co2.break.fit2))

#Seasonal Trend Lowess


```
## Question 3

## Question 4
```{r Q4}


```
