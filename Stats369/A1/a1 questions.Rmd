---
title: "Assignment 1 2020"
author: "David Welch"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
```

Under Modules | Data | Bikes on Canvas you have data on the number of people counted cycling in Auckland and the amount of rain. 
```{r Load Data, echo=FALSE}
base.url = "../data/BIKES/"
bike.data.files = list.files(base.url, pattern="cycle")
rain.data.files = list.files(base.url, pattern="rain")

bike.df = map(paste(base.url,bike.data.files, sep=""),read_csv) %>%
  bind_rows() 

rain.df = rbind(read_csv(paste(base.url,rain.data.files[1], sep=""), skip=9),
                read_csv(paste(base.url,rain.data.files[2], sep=""), skip=9))
```

1.  If you try to convert the cycle count data to tidy format (which you don't have to do for this assignment, because it's hard), what is one obstacle you will encounter?

Lab 2 issue: manual reconcilation of the locations. You will aim to create a single column 'location' for all the counters. Some places like Quay St Vector and Quay Street Spark are the same but there is no automatic way to merge them. This will have to be done manually. The problem with doing this manually is that it introduces human error and can be done wrong.

Use the code as evidence of two places that are hard to automatically merge. 
```{r Look at Data, echo=FALSE}
head(bike.df)
```

2. Compute the total number of cyclists counted for each day, and a suitable summary of the rainfall for each day, in the same data frame.
```{r Q2}
total_cyclists_per_day = bike.df %>%
  filter(!is.na(Date)) %>%
  pivot_longer(data=., names(bike.df[-1]), names_to="Location", "values_to"="Number of Cyclists")  %>%
  separate(col=Date, sep=3, into=c("dow", "date")) %>%
  mutate(timestamp=dmy(date)) %>%
  group_by(timestamp) %>%
  summarise("Total Cyclists" = sum(`Number of Cyclists`, na.rm=TRUE))

mean_rainfall_per_day = rain.df %>%
  mutate(timestamp = ymd(`Date(NZST)`)) %>%
  group_by(timestamp) %>%
  summarise("Mean Rainfall" = mean(`Amount(mm)`, na.rm=TRUE))

rainfall_cyclist_df = inner_join(mean_rainfall_per_day, total_cyclists_per_day, by="timestamp")
```

3. Draw suitable graphs to display how the number of cyclists varies over time, over season, over day of the week, and with rain
```{r Q3}
#Number of cyclists verus time
ggplot(data=rainfall_cyclist_df, aes(x=timestamp, y=`Total Cyclists`)) + geom_line()

#Number of cyclists over season
rainfall_cyclist_df %>%
  mutate(month.no = month(timestamp),
         season = case_when(month.no < 3 | month.no > 11 ~ "Summer",
                            month.no >= 3 & month.no < 6 ~ "Autumn",
                            month.no >= 6 & month.no < 9 ~ "Winter",
                            month.no >=9 & month.no < 12 ~ "Spring")) %>%
  group_by(season) %>%
  summarise(mean.cyclists = mean(`Total Cyclists`, na.rm=TRUE)) %>%
  ggplot(data=., aes(x=season, y=mean.cyclists)) + geom_bar(stat="identity")

#Number of cyclists versus day of the week
rainfall_cyclist_df %>%
  mutate(dow = wday(timestamp, label=TRUE)) %>%
  group_by(dow) %>%
  summarise(mean.cyclists = mean(`Total Cyclists`, na.rm=TRUE)) %>%
  ggplot(data=., aes(x=dow, y=mean.cyclists)) + geom_bar(stat="identity")

#Number of cyclists varies with rain
ggplot(data=rainfall_cyclist_df, aes(x=`Total Cyclists`, y=`Mean Rainfall`)) + geom_point()

```

4. Fit a regression model to predict the number of cyclists from year, season, day of the week, and rain. 

5. Based on your graphs and model, does rain have a big impact on the number of people cycling in Auckland?

 

Upload your rmarkdown (.Rmd) file and the HTML or PDF output that it produces to Canvas. 